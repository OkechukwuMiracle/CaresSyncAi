(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{9753:function(e,t,r){Promise.resolve().then(r.t.bind(r,8877,23)),Promise.resolve().then(r.bind(r,9082))},9082:function(e,t,r){"use strict";r.d(t,{default:function(){return a}});var s=r(7437),n=r(8726),i=r(4674),c=r(4972);function a(e){let{children:t}=e;return(0,s.jsx)(i.FV,{children:(0,s.jsxs)(c.H,{children:[t,(0,s.jsx)(n.x7,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"}}})]})})}},4972:function(e,t,r){"use strict";r.d(t,{H:function(){return o},a:function(){return l}});var s=r(1920),n=r(7437),i=r(2265),c=r(4674),a=r(8726);let u=(0,i.createContext)(),l=()=>{let e=(0,i.useContext)(u);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},o=e=>{let{children:t}=e,{supabase:r}=(0,c.$4)(),[l,o]=(0,i.useState)(null),[d,h]=(0,i.useState)(null),[f,g]=(0,i.useState)(!0),p=(0,i.useRef)(!0),m=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r]},x=(0,i.useCallback)(async()=>{try{let{data:{session:e},error:t}=await r.auth.getSession();if(t){m("⚠️ getSession error:",t);return}if(!(null==e?void 0:e.access_token)){m("⚠️ No Supabase access token found for fetching clinic data.");return}let s=await fetch("".concat("http://localhost:5000","/api/auth/profile"),{headers:{Authorization:"Bearer ".concat(e.access_token)}});if(!p.current)return;if(s.ok){let e=await s.json();if(!p.current)return;h(e.clinic)}else{let e=await s.text();if(console.error("❌ Failed to fetch clinic data:",e),!p.current)return;h(null)}}catch(e){if(console.error("\uD83D\uDD25 Error fetching clinic data:",e),!p.current)return;h(null)}},[r]);(0,i.useEffect)(()=>{p.current=!0,g(!0),(async()=>{try{var e;let{data:{session:t},error:s}=await r.auth.getSession();if(s&&m("⚠️ getSession error:",s),!p.current)return;let n=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:null;o(n),n?await x():h(null)}catch(e){console.error("\uD83D\uDD25 Error during session init:",e)}finally{}})();let e=setTimeout(()=>{p.current&&g(!1)},1500),{data:{subscription:t}}=r.auth.onAuthStateChange(async(t,r)=>{var s;if(m("\uD83D\uDD04 Auth state changed:",t),!p.current)return;let n=null!==(s=null==r?void 0:r.user)&&void 0!==s?s:null;switch(o(n),t){case"SIGNED_IN":case"INITIAL_SESSION":case"TOKEN_REFRESHED":case"USER_UPDATED":n&&await x();break;case"SIGNED_OUT":h(null)}g(!1),clearTimeout(e)});return()=>{var r;m("\uD83E\uDDF9 Cleaning up auth listener"),p.current=!1,clearTimeout(e),null==t||null===(r=t.unsubscribe)||void 0===r||r.call(t)}},[r,x]);let v=async(e,t,r)=>{try{let n=await fetch("".concat("http://localhost:5000","/api/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,s._)({email:e,password:t},r))}),i=await n.json();if(n.ok)return a.ZP.success("Registration successful! Please verify your email."),{success:!0,data:i};return a.ZP.error(i.error||"Registration failed"),{success:!1,error:i.error}}catch(e){return console.error("❌ Sign-up error:",e),a.ZP.error("Registration failed. Please try again."),{success:!1,error:e.message}}},N=async(e,t)=>{let{error:s}=await r.auth.signInWithPassword({email:e,password:t});return s?(a.ZP.error(s.message),{success:!1,error:s.message}):(a.ZP.success("Login successful!"),{success:!0})},S=async()=>{let{error:e}=await r.auth.signOut();return e?(a.ZP.error("Logout failed"),console.error("❌ Sign-out error:",e),{success:!1}):(a.ZP.success("Logged out successfully"),{success:!0})};return(0,n.jsx)(u.Provider,{value:{user:l,clinic:d,loading:f,signUp:v,signIn:N,signOut:S},children:t})}},4674:function(e,t,r){"use strict";r.d(t,{$4:function(){return d},FV:function(){return h}});var s=r(7437),n=r(2265),i=r(46);let c="https://phoumeccawrtsjztxldi.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBob3VtZWNjYXdydHNqenR4bGRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzNDEyNTcsImV4cCI6MjA3NTkxNzI1N30.xMGO_scepJgrqhF318DZuXQwuVcZR47AMS81wFwcQA0";c&&c.startsWith("https://"),a&&a.split(".").length;let u=c&&a?(0,i.eI)(c,a):null,l={supabase:u},o=(0,n.createContext)(),d=()=>{let e=(0,n.useContext)(o);if(!e)throw Error("useSupabase must be used within a SupabaseProvider");return e},h=e=>{let{children:t}=e;if(!u){let e=[];c||e.push("NEXT_PUBLIC_SUPABASE_URL"),a||e.push("NEXT_PUBLIC_SUPABASE_ANON_KEY");let t=e=>"string"==typeof e?"".concat(e.slice(0,6),"...").concat(e.slice(-4)):"";return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"max-w-lg w-full bg-red-50 border border-red-200 rounded-md p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Configuration error"}),(0,s.jsx)("p",{className:"text-sm text-red-700 mb-3",children:"Missing required environment variables. Update client/.env.local and restart the dev server."}),(0,s.jsxs)("ul",{className:"text-sm text-red-700 list-disc pl-5 space-y-1",children:[!c&&(0,s.jsx)("li",{children:"REACT_APP_SUPABASE_URL is missing"}),!a&&(0,s.jsx)("li",{children:"REACT_APP_SUPABASE_ANON_KEY is missing"})]}),(0,s.jsxs)("div",{className:"mt-4 text-xs text-red-700",children:[(0,s.jsx)("div",{children:"Current values (masked):"}),(0,s.jsxs)("div",{children:["URL: ",c?t(c):"(not set)"]}),(0,s.jsxs)("div",{children:["Anon Key: ",a?t(a):"(not set)"]})]}),(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Reload App"})]})})}return(0,s.jsx)(o.Provider,{value:l,children:t})}},8877:function(){}},function(e){e.O(0,[404,46,657,971,23,744],function(){return e(e.s=9753)}),_N_E=e.O()}]);